import{getCLS,getFID,getLCP,getTTFB,getFCP}from"./web-vitals/web-vitals.js";let excluded=[];function getRandomArbitrary(min,max){return Math.random()*(max-min)+min}function sendAnalytics(metrics){navigator.sendBeacon&&navigator.sendBeacon(analyticsSettings.restUrl,JSON.stringify(metrics))}function webVitalsReport({name,value}){sendAnalytics({type:"webvital",resource:location?location.href:"-",authenticated:analyticsSettings.authenticated,metrics:[{name:name,value:value}]})}function performanceReport(timing,type){var start=0<timing.startTime?timing.startTime:0;let analytics={type:type,resource:timing.name,authenticated:analyticsSettings.authenticated,initiator:timing.initiatorType,metrics:[{name:"redirect",start:timing.redirectStart-start,duration:timing.redirectEnd-timing.redirectStart},{name:"dns",start:timing.domainLookupStart-start,duration:timing.domainLookupEnd-timing.domainLookupStart}]};0<timing.secureConnectionStart?analytics.metrics.push({name:"tcp",start:timing.connectStart-start,duration:timing.connectEnd-timing.connectStart},{name:"ssl",start:timing.secureConnectionStart-start,duration:timing.connectEnd-timing.secureConnectionStart}):analytics.metrics.push({name:"tcp",start:timing.connectStart-start,duration:timing.connectEnd-timing.connectStart}),analytics.metrics.push({name:"wait",start:timing.requestStart-start,duration:timing.responseStart-timing.requestStart},{name:"download",start:timing.responseStart-start,duration:timing.responseEnd-timing.responseStart},{name:"load",value:timing.duration},{name:"redirects",value:timing.redirectCount}),0<timing.transferSize?analytics.metrics.push({name:"size",value:timing.transferSize}):analytics.metrics.push({name:"cache",value:1}),sendAnalytics(analytics)}function webVitalsObserve(){getCLS(webVitalsReport),getFID(webVitalsReport),getLCP(webVitalsReport),getTTFB(webVitalsReport),getFCP(webVitalsReport)}function navigationObserve(list,observer){0<list.getEntriesByType("navigation").length&&performanceReport(list.getEntriesByType("navigation")[0],"navigation")}function resourceObserve(list,observer){0<list.getEntriesByType("resource").length&&list.getEntriesByType("resource").forEach(function(timing){"xmlhttprequest"===timing.initiatorType&&"1"===analyticsSettings.smartFilter&&(0<timing.name.indexOf("/beacon")||0<timing.name.indexOf("/livelog"))||!excluded.includes(timing.name)&&analyticsSettings.sampling>=getRandomArbitrary(1,1e3)&&(excluded.push(timing.name),performanceReport(timing,"resource"))})}try{webVitalsObserve();let navigationObserver=new PerformanceObserver(navigationObserve);navigationObserver.observe({entryTypes:["navigation"]});let resourceObserver=new PerformanceObserver(resourceObserve);resourceObserver.observe({entryTypes:["resource"]})}catch(error){console.error("Vibes error: ".error)}